<!DOCTYPE html>
<html lang="en-US">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Hummingbird, by SantaClausNL</title>
		<script src="./dist/hummingbird.js"></script>
		<style>
			html{ background-color: gray; }
			#HummingbirdCanvas{
				margin: auto;
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
			}
		</style>
	</head>
	<body>
		<script>
			let objects;

			function setup() {
				HB.init(1280, 720);

				new HB.Texture('oof', './assets/oof.png');
				new HB.Texture('birb', './assets/logo.svg');
				new HB.Texture('piet', './assets/piet-piraat.jpg');
				new HB.Texture('dickbutt', './assets/dickbutt.jpg');
				new HB.Texture('cat1', './assets/cat1.jpg');
				new HB.Texture('cat2', './assets/cat2.png');
				new HB.Texture('cat3', './assets/cat3.png');
				new HB.Texture('cat4', './assets/cat4.jpg');

				objects = [
					new Bouncer('oof'),
					new Bouncer('birb'),
					new Bouncer('piet'),
					new Bouncer('dickbutt'),
					new Bouncer('cat1'),
					new Bouncer('cat2'),
					new Bouncer('cat3'),
					new Bouncer('cat4'),
				];
			}

			class Bouncer{
				constructor(texture) {
					this.pos = HB.Vec2.new(0, 0);
					this.vec = HB.Vec2.new(HB.Meth.random(-150, 150), HB.Meth.random(-150, 150));
					this.texture = texture;
				}

				update(deltaTime) {
					this.pos[0] += (this.vec[0]*(deltaTime/1000));
					this.pos[1] += (this.vec[1]*(deltaTime/1000));

					if(this.pos[0] > HB.canvas.width-100) {
						this.vec[0] *= -1;
						this.pos[0] = HB.canvas.width-100;
					} else if(this.pos[0] < 0) {
						this.vec[0] *= -1;
						this.pos[0] = 0;
					}
					if(this.pos[1] > HB.canvas.height-100) {
						this.vec[1] *= -1;
						this.pos[1] = HB.canvas.height-100;
					} else if(this.pos[1] < 0) {
						this.vec[1] *= -1;
						this.pos[1] = 0;
					}
				}
			}

			let angle = 0, cameraSpeed = 500;

			function update(deltaTime) {
				HB.renderer.clear();

				const speed = cameraSpeed * (deltaTime/1000);
				Object.entries(HB.keysPressed).forEach(([key, state]) => {
					if(state !== true) return;
					switch(key) {
						case '87': HB.camera.translate(HB.Vec3.new(0, speed, 0)); break;
						case '65': HB.camera.translate(HB.Vec3.new(speed, 0, 0)); break;
						case '83': HB.camera.translate(HB.Vec3.new(0, -speed, 0)); break;
						case '68': HB.camera.translate(HB.Vec3.new(-speed, 0, 0)); break;

						case '69': HB.camera.translate(HB.Vec3.new(0, 0, 0.1)); break;
						case '81': HB.camera.translate(HB.Vec3.new(0, 0, -0.1)); break;
					}
				});

				HB.batch.begin();
					color = HB.Vec4.new(0, 1, 1, 1);
					for(let x = 0, r = 0, g = 1; x < HB.canvas.width; x += 6) {
						color[0] += 0.005, color[1] -= 0.005;
						for(let y = 0; y < HB.canvas.height; y += 6) {
							// HB.batch.drawColoredRect(x, y, 5, 5, color);
							HB.batch.drawTexturedRect(x, y, 5, 5, HB.textures['oof']);
						}
					}

					HB.batch.drawColoredRect(0, 0, 150, 150, HB.Vec4.new(1, 1, 1, 1));
					HB.batch.drawTexturedRect(0, 0, 150, 150, HB.textures['birb']);

					objects.forEach((object) => {
						object.update(deltaTime);
						HB.batch.drawTexturedRect(object.pos[0], object.pos[1], 100, 100, HB.textures[object.texture]);
					});
				HB.batch.end();

				// shader.bind();
				// {
				// 	angle++;
				// 	camera.modelMatrix = Mat4.translate(Mat4.identity(), Vec3.new(-150, -150, 0));
				// 	camera.modelMatrix = Mat4.rotateZ(camera.modelMatrix, Meth.radians(angle));
				// 	camera.modelMatrix = Mat4.translate(camera.modelMatrix, Vec3.new(150, 150, 0));
				// 	const modelView = Mat4.multMat4(camera.modelMatrix, camera.viewMatrix);
				// 	const MVP = Mat4.multMat4(modelView, camera.projectionMatrix);
				// 	shader.setUniformMatrix('f', 'uMVP', MVP);

				// 	renderer.draw(6);
				// }

				// {
				// 	camera.modelMatrix = Mat4.translate(Mat4.identity(), Vec3.new(0, 0, 0));
				// 	const modelView = Mat4.multMat4(camera.modelMatrix, camera.viewMatrix);
				// 	const MVP = Mat4.multMat4(modelView, camera.projectionMatrix);
				// 	shader.setUniformMatrix('f', 'uMVP', MVP);

				// 	renderer.draw(6);
				// }
			}
		</script>
	</body>
</html>